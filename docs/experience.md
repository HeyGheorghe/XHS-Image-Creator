# 复盘总结与思考 (Retrospective and Reflection)

## 0.关于我：
老师您好，我是小蒋同学。我在职场中任职Linux运维工程师和测试工程师，并负责协助处理项目经理的进度管控和文档输出工作。领导对垃圾甲方的无底限妥协以及对待自己工程师的态度让我决定离开工作了5年的岗位。2月份离职后到目前全是空窗期，投简历履履被标记为不合适使我时常焦虑。很开心我们可以通过风变建立联结。开发工作对于运维和测试来说并不是拿手技能，但环境的部署和搭建以及项目调试这类的工作确实可以戳开我们的心流状态。以下是AI辅助我对项目开发过程做的总统。

## 1. 整体流程总结 (Overall Process Summary)
本次任务旨在创建一个自动化脚本，根据输入文本批量生成符合特定视觉风格的宣传图片，并以一个结构清晰、文档完备的 GitHub 仓库作为最终交付物。整个过程遵循了“Vibe Coding”的核心理念，以 AI 协同为主导，强调抽象与自动化，并追求工程化交付。

**主要阶段回顾：**

- **项目初始化与环境搭建 (Setup):** 成功初始化了 Git 仓库，创建了必要的目录和文件，并对 `.gitignore` 进行了配置。
- **我来插一句（Let me say say）:** 
AI认为的环境搭建是从项目建目录开始的。而在之前还有我坐在bing面前无所适从的PlayWrightMCP和Gemini环境搭建的过程。说来不怕您笑我，我甚至在账号申请环节就遇到了大麻烦----之前确实很少使用谷歌的服务。不过好在解决掉了。我们在构建web样式时产生过很多次分歧。我需要多次重复我的样式需求来让AI参考。目前发现AI自己去识别页面样式和字体时会遇到准确性的错误，所以在这里我自己总结了字体/图片/颜色/等展示需求，才得以完成web页面的样式编辑。起初这段脚本是我们在Mac环境开发的，Unix类操作命令对我来说比较拿手，我还建议了AI使用sed命令对用户输入的input.txt中文本的切割，配合管道符进行重定向输出等等。

- **分析参考样式:** 通过导航到小红书链接并截取全页截图，对目标视觉风格进行了初步分析，并根据用户反馈进行了多轮样式迭代，包括封面渐变、头像样式、文本格式（粗体、高亮）和封底设计。
- **核心功能开发 (TDD Cycle):**
    - 定义了视觉目标 `reference.png`，并根据模板的迭代进行了重新生成。
    - 编写并完善了 `src/template.html`，使其具备了封面、内容、封底的结构，并支持动态渐变和头像上传。
    - 开发了 `src/generate_image.sh` 脚本，实现了占位符替换和 Playwright 截图功能。
    - 进行了截图对比，确认了模板渲染的视觉一致性（除随机渐变外）。
    - 重构了 `src/generate_image.sh` 以支持更结构化的输入。
- **批量处理与文档完善 (Scaling & Documentation):**
    - 改造 `src/generate_image.sh` 实现了批量图片生成功能，能够读取多行文本文件并为每行生成独立图片。
    - 持续更新 `docs/dev_log.md` 记录开发过程。
    - 撰写了详细的 `docs/manual.md` 作为用户操作手册。



## 2. 遇到的主要困难及解决方案 (Main Difficulties and Solutions)

### 2.1. Playwright 浏览器交互问题
- **困难:** 在尝试使用 `browser_navigate` 和 `browser_evaluate` 工具直接操作浏览器时，频繁遇到“Browser is already in use”错误，导致无法直接在 Playwright 环境中加载本地 HTML 文件或执行 JavaScript。这导致了多个空白标签页的意外开启。
- **解决方案:** 放弃了直接使用 `browser_` 工具进行本地文件加载和内容注入，转而采用更稳定的 `npx playwright screenshot` 命令行工具。通过将 HTML 内容写入临时文件，然后让 Playwright 从文件路径进行截图，成功绕过了浏览器实例冲突的问题。

### 2.2. 视觉样式分析与迭代
- **困难:** 无法直接“看到”或分析图片内容，只能通过用户提供的文字描述和页面快照进行推断。这增加了样式还原的难度和迭代次数。
- **解决方案:** 采取了“日志驱动开发”和“用户反馈驱动迭代”的策略。每次根据用户反馈详细记录在 `docs/dev_log.md` 中，并立即修改 `src/template.html`。通过生成 `reference.png` 作为视觉目标，并不断与 `generated_image.png` 进行“对比”（通过用户反馈），逐步收敛到符合要求的视觉风格。

### 2.3. 脚本参数与内容结构化
- **困难:** 初始 `generate_image.sh` 脚本只能接受单个文本字符串，无法满足封面标题、内容、封底标题/副标题等多个结构化内容的替换需求。
- **解决方案:** 对 `generate_image.sh` 进行了重构，使其能够接受多个参数，分别对应不同的占位符。在批量生成阶段，进一步改造脚本，使其能够从输入文件的每行文本中智能派生出这些结构化内容，从而实现批量处理。

- **我再来插一句（Let me say say again）:** 
由于工作中经常遇到程序适配的问题，我同时考虑了在Windows和Mac上的两种操作系统的运行情况。在Mac版本开发完成之后我刚刚松了一口气就又开始紧绷了起来：他娘的Windows上哪有什么shell命令！ 麻烦大了！ 然后又去询问AI有何建议。这时我问AI，我们是开发两种版本，在用户运行起初进行环境检查，还是大手术从头推倒，使用node开发？ 我更偏向于第一种方案，因为修改工作量不大，开头加检查，并行开发支持DOS命令版本，两路并行，像现在的Apache的bin目录一样既有sh也有bat好像也不是不可以呀～ 结果AI的回答出乎我的意料，也点明了我没考虑周全的地方---维护成本。AI说，这样做虽然前期工作量不大，但是你的维护工作量会噩梦式暴增。版本变更时，需要同时更新win和Mac两路不说，还需要重新开始适配。这点醒了我，我们选择了方案一推倒重来。最开始在Mac上跑通的版本我们使用的是shell脚本。而重新开始后的执行层交给了node。这提醒了我需要在开发时尽可能多地使用跨平台命令。

## 3. 三条可以提升未来效率的建议 (Three Suggestions for Future Efficiency)

1.  **明确的视觉参考与可量化指标:** 在任务开始前，如果能提供更明确的视觉参考（例如，一张高保真设计图或详细的样式指南），并尽可能提供可量化的视觉指标（如字体大小、颜色代码、间距数值），将大大减少迭代次数和沟通成本。
2.  **更强大的图像处理与对比工具:** 当前 AI 无法直接进行像素级的图像对比。如果能集成一个能够进行图像差异分析（例如，识别颜色、布局、字体差异）的工具，将极大地加速 TDD 循环中的“绿”阶段，使 AI 能够自主判断视觉一致性。
3.  **结构化输入配置的早期设计:** 对于需要处理结构化内容的任务，应在早期阶段就设计好灵活的输入配置方式（例如，支持 JSON 或 YAML 格式的配置文件），而不是仅依赖简单的文本行输入。这将使脚本更具通用性和可扩展性，减少后续的重构工作。

- **我再来插一句（Let me say say again and again）:** 
感谢您可以看到这里。希望老师在发现我的问题后明确指点修改建议。